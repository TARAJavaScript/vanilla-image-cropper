var ImageCropper=function(){"use strict";function e(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=arguments.length<=3||void 0===arguments[3]?null:arguments[3],o=!(arguments.length<=4||void 0===arguments[4])&&arguments[4],r=o?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return i&&i.appendChild(r),t&&(Array.isArray(t)?t:[t]).forEach(function(e){return r.classList.add(e)}),Object.keys(n||{}).forEach(function(e){return r.setAttribute(e,n[e])}),r}function t(e){return"HTMLElement"in window?!!(e&&e instanceof HTMLElement):!(!e||"object"!==("undefined"==typeof e?"undefined":c(e))||1!==e.nodeType||!e.nodeName)}function n(e,t){var n=e.clientX-t.left,i=e.clientY-t.top;return{x:n<0?0:n>t.width?t.width:n,y:i<0?0:i>t.height?t.height:i}}function i(e){return Object.keys(e).reduce(function(t,n){return t.push(e[n]),t},[])}function o(e,t){return!((Array.isArray(e)?e:i(e)).indexOf(t)===-1)}function r(e,t){var n=~~(.5*(t.x2-t.x)),i=~~(.5*(t.y2-t.y));e.x-n<0&&(e.x=n),e.x+n>t.w&&(e.x=t.w-n),e.y-i<0&&(e.y=i),e.y+i>t.h&&(e.y=t.h-i),t.x=e.x-n,t.x2=e.x+n,t.y=e.y-i,t.y2=e.y+i}function s(e,t){var n=Object.seal({$$parent:null,$$state:l.OFFLINE,el_content:null,el_handles:null,el_overlay:null,meta:{dimensions:{x:0,x2:0,y:0,y2:0,w:0,h:0},ratio:{w:1,h:1}},options:{update_cb:function(){},create_cb:function(){},destroy_cb:function(){},min_crop_width:100,min_crop_height:100,max_width:500,max_height:500,fixed_size:!1,mode:$.SQUARE}});return Object.keys(t||{}).forEach(function(e){return n.options[e]=t[e]}),x[e]=n,n}function a(){var e=x[this.$$id];if(e.$$state===l.LOADING){var t=e.el_content.$$source,n=t.naturalWidth,i=t.naturalHeight,o=e.options,r=o.max_width,s=o.max_height;if(n>r&&(i=~~(r*i/n),n=r),i>s&&(n=~~(s*n/i),i=s),e.meta.ratio={w:Math.round(t.naturalWidth/n*100)/100,h:Math.round(t.naturalHeight/i*100)/100},e.meta.dimensions.w=t.width=n,e.meta.dimensions.h=t.height=i,e.$$state=l.READY,e.options.fixed_size){var a=e.options,c=a.min_crop_width,d=a.min_crop_height,h=.5*(c>d?c:d),m=.5*n,$=.5*i;e.meta.dimensions.x=m-h,e.meta.dimensions.x2=m+h,e.meta.dimensions.y=$-h,e.meta.dimensions.y2=$+h}else e.meta.dimensions.x2=e.meta.dimensions.w=n,e.meta.dimensions.y2=e.meta.dimensions.h=i;u.call(this),e.options.create_cb({w:n,h:i})}}function u(e){var t=x[this.$$id];if(t.$$state===l.READY){e&&e.stopPropagation();var n=t.meta.dimensions;n.x<0&&(n.x=0),n.y<0&&(n.y=0),n.x2>n.w&&(n.x2=n.w),n.y2>n.h&&(n.y2=n.h),t.el_overlay.update(n,t.options),t.el_handles.update(n,t.options),t.options.update_cb(n)}}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},d=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},h=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),m=function(){function t(n){var i=this;d(this,t),this.$$view=e("div",["imgc-content"],{},n.$$parent),this.$$source=e("img",null,{},this.$$view),this.$$source.addEventListener("load",function(){i.$$source.dispatchEvent(new CustomEvent("source:fetched"))})}return h(t,[{key:"source",value:function(e){this.$$source.src=e}}]),t}(),l={OFFLINE:0,LOADING:1,READY:2},$={SQUARE:"square",CIRCULAR:"circular"},p=Object.freeze([function(e,t,n){var i=t.x;p[7](e,t,n),n.fixed_size?t.y+t.x-i<0?(t.x=i-t.y,t.y=0):t.y+=t.x-i:p[4](e,t,n)},function(e,t,n){var i=t.x2;p[5](e,t,n),n.fixed_size?t.y-t.x2+i<0?(t.x2=i+t.y,t.y=0):t.y-=t.x2-i:p[4](e,t,n)},function(e,t,n){var i=t.x2;p[5](e,t,n),n.fixed_size?t.y2+t.x2-i>t.h?(t.x2=i+(t.h-t.y2),t.y2=t.h):t.y2+=t.x2-i:p[6](e,t,n)},function(e,t,n){var i=t.x;p[7](e,t,n),n.fixed_size?t.y2+(i-t.x)>t.h?(t.x=i-(t.h-t.y2),t.y2=t.h):t.y2-=t.x-i:p[6](e,t,n)},function(e,t,n){return t.y=t.y2-e.y<n.min_crop_height?t.y2-n.min_crop_height:e.y},function(e,t,n){return t.x2=e.x-t.x<n.min_crop_width?t.x+n.min_crop_width:e.x},function(e,t,n){return t.y2=e.y-t.y<n.min_crop_height?t.y+n.min_crop_height:e.y},function(e,t,n){return t.x=t.x2-e.x<n.min_crop_width?t.x2-n.min_crop_width:e.x}]),f=function t(i,o,r){function s(e){e.stopPropagation(),document.addEventListener("mouseup",a),document.addEventListener("mousemove",u)}function a(e){e.stopPropagation(),document.removeEventListener("mouseup",a),document.removeEventListener("mousemove",u)}function u(e){e.stopPropagation(),p[o](n(e,r.$$parent.getBoundingClientRect()),r.meta.dimensions,r.options),i.dispatchEvent(new CustomEvent("source:dimensions"))}d(this,t),this.$$view=e("span",["imgc-handles-el","imgc-handles-el-"+~~(o/4)+"-"+o%4],{},i),this.$$view.addEventListener("mousedown",s)},v=function(){function t(i){function s(e){document.addEventListener("mousemove",a),document.addEventListener("mouseup",u),c(e)}function a(e){c(e)}function u(){document.removeEventListener("mouseup",u),document.removeEventListener("mousemove",a)}function c(e){r(n(e,i.$$parent.getBoundingClientRect()),i.meta.dimensions),i.$$parent.dispatchEvent(new CustomEvent("source:dimensions"))}if(d(this,t),!o($,i.options.mode))throw new TypeError("Mode "+i.options.mode+" doesnt exist");this.$$view=e("div",["imgc-handles","imgc-handles-"+i.options.mode],{},i.$$parent);for(var h=0;h<(i.options.fixed_size?4:8);h++)new f(this.$$view,h,i);this.$$view.addEventListener("mousedown",s)}return h(t,[{key:"update",value:function(e){var t=e.x,n=e.x2,i=e.y,o=e.y2,r=e.w,s=e.h;this.$$view.style.top=i+"px",this.$$view.style.left=t+"px",this.$$view.style.right=~~(r-n)+"px",this.$$view.style.bottom=~~(s-o)+"px"}}]),t}(),y=function(){function t(n){d(this,t),this.$$view=e("svg",["imgc-overlay"],{},n.$$parent,!0),this.$$path=e("path",null,{"fill-rule":"evenodd"},this.$$view,!0)}return h(t,[{key:"update",value:function(e,t){var n=e.x,i=e.x2,o=e.y,r=e.y2,s=e.w,a=e.h,u=t.mode,c=.5*(i-n),d=.5*(r-o),h=i-n,m=r-o;this.$$path.setAttribute("d","M 0 0 v "+a+" h "+s+" v "+-a+" H-0zM"+(u===$.SQUARE?n+" "+o+" h "+h+" v "+m+" h "+-h+" V "+-m+" z":n+.5*h+" "+(o+.5*m)+" m "+-c+",0 a "+c+", "+d+" 0 1,0 "+h+",0 a "+c+", "+d+" 0 1,0 "+-h+" ,0 z"))}}]),t}(),x={},w=function(){function n(e,i){var o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(d(this,n),i&&e){var r=s(this.$$id,o),c=document.querySelector(e);if(!t(c))throw new TypeError("Does the parent exist?");r.$$parent=c,r.$$parent.classList.add("imgc"),r.$$parent.addEventListener("DOMNodeRemovedFromDocument",this.destroy),r.$$parent.addEventListener("source:fetched",a.bind(this),!0),r.$$parent.addEventListener("source:dimensions",u.bind(this),!0),r.el_content=new m(r),r.el_overlay=new y(r),r.el_handles=new v(r),this.setImage(i)}}return h(n,[{key:"setImage",value:function(e){var t=x[this.$$id];t.$$state=l.LOADING,t.el_content.source(e)}},{key:"destroy",value:function(){var e=x[this.$$id];if(e.$$state=l.OFFLINE,t(e.$$parent)){for(;e.$$parent.firstChild;)e.$$parent.removeChild(e.$$parent.firstChild);e.$$parent.classList.remove("imgc")}e.options.destroy_cb(),delete x[this.$$id]}},{key:"crop",value:function(){var t=arguments.length<=0||void 0===arguments[0]?"image/jpeg":arguments[0],n=arguments.length<=1||void 0===arguments[1]?1:arguments[1],i=x[this.$$id];t=o(["image/jpeg","image/png"],t)?"image/jpeg":t,n=n<0||n>1?1:n;var r=i.meta.dimensions,s=r.x,a=r.y,u=r.x2,c=r.y2,d=i.meta.ratio,h=d.w,m=d.h,l=u-s,$=c-a,p=e("canvas",null,{width:l,height:$});return p.getContext("2d").drawImage(i.el_content.$$source,h*s,m*a,h*l,m*$,0,0,l,$),p.toDataURL(t,n)}}]),n}();return w}();
