var ImageCropper=function(){"use strict";function e(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=arguments.length<=3||void 0===arguments[3]?null:arguments[3],o=!(arguments.length<=4||void 0===arguments[4])&&arguments[4],r=o?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return i&&i.appendChild(r),t&&(Array.isArray(t)?t:[t]).forEach(function(e){return r.classList.add(e)}),Object.keys(n||{}).forEach(function(e){return r.setAttribute(e,n[e])}),r}function t(e){return"HTMLElement"in window?!!(e&&e instanceof HTMLElement):!(!e||"object"!==("undefined"==typeof e?"undefined":h(e))||1!==e.nodeType||!e.nodeName)}function n(e,t){var n=e.clientX-t.left,i=e.clientY-t.top;return{x:n<0?0:n>t.width?t.width:n,y:i<0?0:i>t.height?t.height:i}}function i(e){e.stopPropagation(),document.addEventListener("mouseup",o.bind(this)),document.addEventListener("mousemove",r.bind(this))}function o(e){e.stopPropagation(),document.removeEventListener("mouseup",o.bind(this)),document.removeEventListener("mousemove",r.bind(this))}function r(e){e.stopPropagation(),$[this.$$type](n(e,this.$$scope.elements.source.getBoundingClientRect()),this.$$scope.meta.dimensions,this.$$scope.options,this.$$scope.elements.source)}function s(e){return Object.keys(e).reduce(function(t,n){return t.push(e[n]),t},[])}function a(e,t){var n=!1;return s(e).forEach(function(e){(n||e===t)&&(n=!0)}),n}function u(){if(g.$$state===f.LOADING){var e=g.elements.content.$$source,t=e.naturalWidth,n=e.naturalHeight;t>g.options.max_width&&(n=~~(g.options.max_width*n/t),t=g.options.max_width),n>g.options.max_height&&(t=~~(g.options.max_height*t/n),n=g.options.max_height),g.meta.ratio={w:Math.round(e.naturalWidth/t*100)/100,h:Math.round(e.naturalHeight/n*100)/100},e.width=t,e.height=n,g.$$state=f.READY,g.meta.dimensions.x2=g.meta.dimensions.w=t,g.meta.dimensions.y2=g.meta.dimensions.h=n,g.meta.dimensions.x=50,g.meta.dimensions.y=50,g.meta.dimensions.x2=100,g.meta.dimensions.y2=100,c()}}function c(){if(g.$$state===f.READY){var e=g.meta.dimensions;e.x<0&&(e.x=0),e.y<0&&(e.y=0),e.x2>e.w&&(e.x2=e.w),e.y2>e.h&&(e.y2=e.h),g.elements.overlay.update(e,g.options),g.elements.handles.update(e,g.options)}}var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},d=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},m=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=function(){function t(n){var i=this;d(this,t),this.$$view=e("div",["imgc-content"],{},n),this.$$source=e("img",null,{},this.$$view),this.$$source.addEventListener("load",function(){i.$$source.dispatchEvent(new CustomEvent("source:fetched"))})}return m(t,[{key:"source",value:function(e){this.$$source.src=e}}]),t}(),f={OFFLINE:0,LOADING:1,READY:2},p={SQUARE:"square",CIRCULAR:"circular"},$=Object.freeze([function(e,t,n){var i=t.x.x;$[7](e,t,n),n.fixed_size?t.y+t.x-i<0?(t.x=i-t.y,t.y=0):t.y+=t.x-i:$[4](e,t,n)},function(e,t,n){var i=t.x2;$[5](e,t,n),n.fixed_size?t.y-t.x2+i<0?(t.x2=i+t.y,t.y=0):t.y-=t.x2-i:$[4](e,t,n)},function(e,t,n,i){var o=t.x2;if($[5](e,t,n),n.fixed_size){var r=i.getBoundingClientRect();t.y2+t.x2-o>r.height?(t.x2=o+(r.height-t.y2),t.y2=r.height):t.y2+=t.x2-o}else $[6](e,t,n)},function(e,t,n,i){var o=t.x;if($[7](e,t,n),n.fixed_size){var r=i.getBoundingClientRect();t.y2+(o-t.x)>r.height?(t.x=o-(r.height-t.y2),t.y2=r.height):t.y2-=t.x-o}else $[6](e,t,n)},function(e,t,n){return t.y=t.y2-e.y<n.min_crop_height?t.y2-n.min_crop_height:e.y},function(e,t,n){return t.x2=e.x-t.x<n.min_crop_width?t.x+n.min_crop_width:e.x},function(e,t,n){return t.y2=e.y-t.y<n.min_crop_height?t.y+n.min_crop_height:e.y},function(e,t,n){return t.x=t.x2-e.x<n.min_crop_width?t.x2-n.min_crop_width:e.x}]),y=function t(n,o){d(this,t),this.$$view=e("span",["imgc-handles-el","imgc-handles-el-"+~~(o/4)+"-"+o%4],{},n),this.$$view.addEventListener("mousedown",i.bind(this)),this.$$type=o},v=function(){function t(n,i){var o=i.mode,r=i.fixed_size;if(d(this,t),!a(p,o))throw new TypeError("Mode "+o+" doesnt exist");this.$$view=e("div",["imgc-handles","imgc-handles-"+o],{},n);for(var s=0;s<(r?4:8);s++)new y(this.$$view,s)}return m(t,[{key:"update",value:function(e){var t=e.x,n=e.x2,i=e.y,o=e.y2,r=e.w,s=e.h;this.$$view.style.top=i+"px",this.$$view.style.left=t+"px",this.$$view.style.right=~~(r-n)+"px",this.$$view.style.bottom=~~(s-o)+"px"}}]),t}(),x=function(){function t(n){d(this,t),this.$$view=e("svg",["imgc-overlay"],{},n,!0),this.$$path=e("path",null,{"fill-rule":"evenodd"},this.$$view,!0)}return m(t,[{key:"update",value:function(e,t){var n=e.x,i=e.x2,o=e.y,r=e.y2,s=e.w,a=e.h,u=t.mode,c=.5*s,h=.5*a,d=i-n,m=r-o;this.$$path.setAttribute("d","M 0 0 v "+a+" h "+s+" v "+-a+" H-0zM"+(u===p.SQUARE?n+" "+o+" h "+d+" v "+m+" h "+-d+" V "+-m+" z":n+.5*d+" "+(o+.5*m)+" m "+-c+",0 a "+c+", "+h+" 0 1,0 "+d+",0 a "+c+", "+h+" 0 1,0 "+-d+" ,0 z"))}}]),t}(),g=Object.seal({$$parent:null,$$state:f.OFFLINE,meta:{dimensions:{x:0,x2:0,y:0,y2:0,w:0,h:0},ratio:{w:1,h:1}},elements:{content:null,overlay:null,handles:null},options:{update_cb:function(){},create_cb:function(){},destroy_cb:function(){},min_crop_width:32,min_crop_height:32,max_width:500,max_height:500,fixed_size:!1,mode:p.SQUARE}}),w=function(){function e(n,i){var o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(d(this,e),i&&n){Object.keys(o||{}).forEach(function(e){return g.options[e]=o[e]});var r=document.querySelector(n);if(!t(r))throw new TypeError("Does the parent exist?");g.$$parent=r,g.$$parent.classList.add("imgc"),g.$$parent.addEventListener("DOMNodeRemovedFromDocument",this.destroy),g.$$parent.addEventListener("source:fetched",u,!0),g.elements.content=new l(g.$$parent,g.options),g.elements.overlay=new x(g.$$parent,g.options),g.elements.handles=new v(g.$$parent,g.options),this.setImage(i)}}return m(e,[{key:"setImage",value:function(e){g.$$state=f.LOADING,g.elements.content.source(e)}},{key:"destroy",value:function(){if(g.$$state=f.OFFLINE,t(g.$$parent)){for(;g.$$parent.firstChild;)g.$$parent.removeChild(g.$$parent.firstChild);g.$$parent.classList.remove("imgc")}}},{key:"crop",value:function(){}}]),e}();return w}();
